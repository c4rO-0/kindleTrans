{%extends 'NavBar.html.j2'%}

{%block head%}

<title>{{ gettext("在线转化txt为mobi") }}</title>
<script src="{{ url_for('static', filename='Scripts/TransformEbook.js') }}"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
{%endblock%}

{%block body%}

{# 得到file #}
{% set fileDict = J2SessionQueryFileUpload()  %}
{% if fileDict == None %}
<form id="formUpload" method="POST" enctype="multipart/form-data">
<h1>{{ gettext( "上传" ) }}</h1>
    {{ form.hidden_tag() }}
    {{ form.file }}
    {# 提交按钮 #}
    {{ form.upload }}
    {# 输出错误 #}
    {% for error in form.file.errors %}
    <div class="alert alert-danger" role="alert">
        [{{ error }}]
    </div>
    {% endfor %}
</form>
{% else %}

<h1>{{  gettext( "书名" ) }}</h1>
<p>  {{ fileDict['filename'] }}</p>

<h1>{{  gettext( "目录" ) }}</h1>
{% set TOC = J2SessionQueryTOC() %}
{% if TOC != None %}
    <div id='TOC'>
        {% for slide in TOC %}
        <p index ={{ slide[0] }} del="" > 
            {{ slide[1] }} 
        </p>
        {% endfor %}
    </div>
    
{% endif %}


<form id="formTran" method="POST" enctype="multipart/form-data">
{{ formTran.hidden_tag() }}

{# 生成目录 目录不需要显示 #}
{{ formTran.TOClistindex }}

{# 因为在提交之前要做一些处理, 用confirmTOCTransfer替代#}
<button id="confirmTOCTransfer">确定目录</button>
{{ formTran.confirmTOC(style="display: none;") }}

{% for error in formTran.confirmTOC.errors %}
<div class="alert alert-danger" role="alert">
    [{{error}}]
</div>
{% endfor %}
</form>
{% endif %}


{#====================================
<div class="progress" style="display: none;">
    <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;">
        0% 
    </div> 
</div>
=====================================#}


{%endblock%}